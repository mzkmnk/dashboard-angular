<p-toast />

<div class="h-screen w-screen">
    <!-- ヘッダー -->
    <!-- <div class="h-16 px-3"></div> -->
    <!-- メインコンテンツ -->
    <div class="flex h-full flex-row">
        <div class="h-full w-full px-14 pt-1">
            <div class="flex w-full items-center justify-between pb-1">
                <div class="flex flex-col">
                    <h1 class="font-semibold">Tasks</h1>
                </div>
                <div class="flex gap-2">
                    <p-avatar [style]="$user().style" [label]="$user().label" [size]="$user().size" [shape]="$user().shape"></p-avatar>
                </div>
            </div>
            <p-tabView>
                <p-tabPanel>
                    <ng-template pTemplate="header">
                        <div class="flex items-center gap-2">
                            <i class="pi pi-th-large"></i>
                            <span class="white-space-nowrap m-0 font-bold">
                                <p>Kanban</p>
                            </span>
                        </div>
                    </ng-template>
                    <div class="dot grid grid-cols-4 gap-8">
                        @for(status of taskStatus;let i = $index; track i){
                            <div class="flex h-full flex-col">
                                <div class="mb-3 flex items-center justify-between  rounded-lg bg-[#f6f7fa] py-1 pl-2">
                                    <div class="flex flex-row items-center">
                                        <i class="pi pi-circle text-xl" [class]=" taskStatusColor[status]"></i>
                                        <h4 class="ml-3 font-medium">{{ status }}</h4>
                                        <p class="ml-5 aspect-square rounded-sm bg-indigo-100 px-2 text-center font-semibold text-indigo-800">{{ getStatusTaskCnt(status) }}</p>
                                    </div>
                                    <p-button class="text-xl" styleClass="text-slate-800" icon="pi pi-plus" severity="secondary"  [rounded]="true" [text]="true" (onClick)="onClickShowAddTask(status)"></p-button>
                                </div>
                                <div class="scrollbar h-[calc(100vh-165px)] overflow-auto rounded-b-2xl">
                                    @for(editTask of $editingTasks()|keyvalue;track editTask.value.id){
                                        @if(editTask.value.status === status){
                                            <div class="mb-5 flex flex-col gap-3 rounded-2xl border bg-white px-4 pt-4 shadow-sm">
                                                <textarea
                                                    style="resize: none;"
                                                    pInputTextarea
                                                    placeholder="What is the Task?"
                                                    [(ngModel)]="editTask.value.description"
                                                >
                                                </textarea>
                                                <div class="flex w-full flex-row items-center gap-2">
                                                    <i class="pi pi-tag text-slate-400"></i>
                                                    <p-multiSelect 
                                                        class="w-full"
                                                        styleClass="w-full"
                                                        optionLabel="name" 
                                                        placeholder="Select Tags"
                                                        [options]="tags"
                                                        [(ngModel)]="editTask.value.tags"
                                                    />
                                                </div>
                                                <p-divider />
                                                <div class="flex flex-row items-center justify-between gap-2">
                                                    <div class="flex w-full flex-row items-center justify-center gap-2 text-slate-400">
                                                        <p-floatLabel class="w-full">
                                                            <p-calendar class="w-full" styleClass="w-full" appendTo="body"   [(ngModel)]="editTask.value.startDate" />
                                                            <label for="endDate">Start Date</label>
                                                        </p-floatLabel>   
                                                    </div>
                                                    <div class="flex w-full flex-row items-center justify-center gap-2 text-slate-400">
                                                        <p-floatLabel class="w-full">
                                                            <p-calendar class="w-full" styleClass="w-full" appendTo="body"   [(ngModel)]="editTask.value.endDate" />
                                                            <label for="endDate">End Date</label>
                                                        </p-floatLabel>    
                                                    </div>
                                                </div>
                                                <div class="flex flex-row items-center justify-end gap-2 pb-2">
                                                    <p-button size="small" [outlined]="true" (onClick)="onClickCancelEditingTask(editTask.value.id)">
                                                        <div>
                                                            <p>cancel</p>
                                                        </div>
                                                    </p-button>
                                                    <p-button size="small" [disabled]="editTask.value.description.length === 0" [outlined]="true" (onClick)="onClickSaveTask(editTask.value.id)">
                                                        <div>
                                                            <p>Save</p>
                                                        </div>
                                                    </p-button>
                                                </div>
                                            </div>
                                        }
                                    }
                                    @for(task of $tasks();let j = $index; track j){
                                        @if(task.status === status){
                                            <div class="mb-5 flex flex-col rounded-2xl border bg-white p-4 shadow-sm">
                                                <div class="mb-2 flex flex-row gap-2">
                                                    @if(task.tags.length === 0){
                                                        <p-tag styleClass="font-semibold" value="No Tags" severity="secondary"></p-tag>
                                                    }@else {
                                                        @for(tag of task.tags;let k=$index; track k){
                                                            <p-tag styleClass="font-semibold" [value]="tag.name"></p-tag>
                                                        }
                                                    }
                                                </div>
                                                <p class="text-sm">{{task.description}}</p>
                                                <p-divider />
                                                <div class="flex items-center justify-between">
                                                    <div>
                                                        <div class="flex flex-row items-center justify-center gap-2 text-xs text-slate-400">
                                                            <i class="pi pi-flag"></i>
                                                            <p>{{task.endDate | date:'MMM d'}}</p>
                                                        </div>
                                                    </div>
                                                    <p-avatarGroup>
                                                        @for(avatar of task.members;let k=$index; track k){
                                                            <p-avatar [style]="avatar.style" [label]="avatar.label" [shape]="avatar.shape"></p-avatar>
                                                        }
                                                    </p-avatarGroup>
                                                </div>
                                            </div>
                                        }
                                    }
                                </div>
                            </div>
                        }
                    </div>
                </p-tabPanel>
                <p-tabPanel>
                    <ng-template pTemplate="header">
                        <div class="flex items-center gap-2">
                            <i class="pi pi-align-right"></i>
                            <span class="white-space-nowrap m-0 font-bold">
                                <p>Timeline</p>
                            </span>
                        </div>
                    </ng-template>
                    <h1>Timeline</h1>
                </p-tabPanel>
            </p-tabView>
        </div>
    </div>
</div>